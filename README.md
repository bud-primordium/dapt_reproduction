
# DAPT æ•°å€¼å¤ç°é¡¹ç›®

**ä½œè€…**: Gilbert Young  
**æ—¥æœŸ**: 2025-06-07

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ—¨åœ¨æ•°å€¼å¤ç° G. Rigolin å’Œ G. Ortiz 2014å¹´å‘è¡¨åœ¨ Physical Review A ä¸Šçš„è®ºæ–‡ã€Šç®€å¹¶ç»çƒ­å¾®æ‰°ç†è®º (DAPT)ã€‹ç¬¬å…«èŠ‚çš„æ•°å€¼ç¤ºä¾‹ã€‚

## é¡¹ç›®ç»“æ„

```
dapt_reproduction/
â”œâ”€â”€ dapt_tools/              # æ ¸å¿ƒè®¡ç®—åº“
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ hamiltonian.py       # ç‰©ç†æ¨¡å‹ï¼šå“ˆå¯†é¡¿é‡ä¸æœ¬å¾ç³»ç»Ÿ
â”‚   â”œâ”€â”€ exact_solver.py      # åŸºå‡†è§£ï¼šç²¾ç¡®è–›å®šè°”æ–¹ç¨‹æ±‚è§£å™¨
â”‚   â”œâ”€â”€ dapt_core.py         # æ ¸å¿ƒç†è®ºï¼šDAPTé€’æ¨ç®—æ³•ä¸æ³¢å‡½æ•°é‡æ„
â”‚   â””â”€â”€ utils.py             # è¾…åŠ©å·¥å…·ï¼šä¸å¿ è¯šåº¦è®¡ç®—ä¸å¯è§†åŒ–
â”œâ”€â”€ tests/                   # å•å…ƒæµ‹è¯•å¥—ä»¶
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_hamiltonian.py
â”‚   â”œâ”€â”€ test_exact_solver.py
â”‚   â”œâ”€â”€ test_dapt_core.py
â”‚   â””â”€â”€ test_utils.py
â”œâ”€â”€ figures/                 # ç»“æœä¸å¯¹æ¯”å›¾
â”‚   â”œâ”€â”€ paper_originals/     # è®ºæ–‡åŸå§‹å›¾è¡¨æˆªå›¾
â”‚   â”œâ”€â”€ attempt_before_fix/  # ç†è®ºä¿®æ­£å‰çš„å¤ç°å°è¯•ç»“æœ
â”‚   â””â”€â”€ attempt_after_fix/   # ç†è®ºä¿®æ­£åçš„å¤ç°å°è¯•ç»“æœ
â”œâ”€â”€ pyproject.toml           # é¡¹ç›®é…ç½®
â”œâ”€â”€ å¤ç°ç¬”è®°.md             # ç†è®ºèƒŒæ™¯ã€å…¬å¼æ¨å¯¼ä¸å®éªŒè®¾è®¡
â””â”€â”€ README.md                # é¡¹ç›®è¯´æ˜
```

## æ ¸å¿ƒåŠŸèƒ½æ‹†è§£

### 1. ç‰©ç†æ¨¡å‹ (`hamiltonian.py`)
- **åŠŸèƒ½**: å®šä¹‰è®ºæ–‡ä¸­å››èƒ½çº§ç³»ç»Ÿçš„å«æ—¶å“ˆå¯†é¡¿é‡åŠå…¶è§£ææœ¬å¾ä½“ç³»ã€‚
- **å…³é”®å®ç°**:
  - `get_hamiltonian`: æ„é€ ç¬æ—¶å“ˆå¯†é¡¿é‡çŸ©é˜µã€‚
  - `get_eigensystem`: ä½¿ç”¨è§£æå…¬å¼è®¡ç®—ç¬æ—¶æœ¬å¾å€¼å’Œæœ¬å¾çŸ¢é‡ï¼Œç¡®ä¿åŸºçŸ¢è¿ç»­æ€§ã€‚
  - `get_eigenvector_derivatives`: è§£æè®¡ç®—æœ¬å¾çŸ¢é‡çš„å¯¼æ•°ï¼Œä¸ºè®¡ç®—è€¦åˆçŸ©é˜µæä¾›é«˜ç²¾åº¦è¾“å…¥ã€‚

### 2. ç²¾ç¡®è§£æ±‚è§£å™¨ (`exact_solver.py`)
- **åŠŸèƒ½**: æä¾›ç²¾ç¡®æ•°å€¼è§£ï¼Œä½œä¸ºDAPTè¿‘ä¼¼ç»“æœçš„éªŒè¯åŸºå‡†ã€‚
- **å…³é”®å®ç°**:
  - `solve_schrodinger_exact`: ä½¿ç”¨`scipy.integrate.solve_ivp`é«˜ç²¾åº¦æ±‚è§£å«æ—¶è–›å®šè°”æ–¹ç¨‹ `iÄ§v|âˆ‚Ïˆ/âˆ‚sâŸ© = H(s)|ÏˆâŸ©`ã€‚

### 3. DAPTæ ¸å¿ƒç®—æ³• (`dapt_core.py`)
- **åŠŸèƒ½**: å®ç°DAPTç†è®ºçš„æ ¸å¿ƒè®¡ç®—æ­¥éª¤ã€‚
- **å…³é”®å®ç°**:
  - `calculate_M_matrix`: è®¡ç®—å­ç©ºé—´ä¹‹é—´çš„è€¦åˆçŸ©é˜µ `M^{nm}(s) = âŸ¨n(s)|âˆ‚_s m(s)âŸ©`ã€‚
  - `solve_wz_phase`: æ±‚è§£Wilczek-Zee (WZ) ç›¸çŸ©é˜µ `U^n(s)` çš„æ¼”åŒ–å¾®åˆ†æ–¹ç¨‹ã€‚
  - `dapt_recursive_step`: **DAPTé€’æ¨ç®—æ³•çš„æ ¸å¿ƒå®ç°**ï¼Œç”¨äºé€é˜¶è®¡ç®—ä¿®æ­£ç³»æ•° `B_{mn}^{(p)}`ã€‚
  - `run_dapt_calculation`: ç»„ç»‡å®Œæ•´çš„DAPTè®¡ç®—æµç¨‹ï¼Œä»0é˜¶åˆå§‹åŒ–åˆ°é«˜é˜¶ä¿®æ­£ï¼Œå¹¶æœ€ç»ˆé‡æ„å„é˜¶è¿‘ä¼¼æ³¢å‡½æ•°ã€‚

### 4. è¾…åŠ©å·¥å…· (`utils.py`)
- **åŠŸèƒ½**: æä¾›æ•°æ®å¤„ç†ã€è¯„ä¼°å’Œå¯è§†åŒ–çš„å‡½æ•°ã€‚
- **å…³é”®å®ç°**:
  - `calculate_infidelity`: è®¡ç®—ä¸å¿ è¯šåº¦ `I(s) = 1 - |âŸ¨Î¨_exact|Î¨_approxâŸ©|Â²`ã€‚
  - `plot_infidelity_comparison`: ç»˜åˆ¶å„é˜¶DAPTç»“æœä¸ç²¾ç¡®è§£çš„ä¸å¿ è¯šåº¦å¯¹æ¯”å›¾ã€‚
  - `calculate_epsilon_parameter`: è®¡ç®—è®ºæ–‡ä¸­çš„å…³é”®æ— é‡çº²å‚æ•° `Îµ(s)`ã€‚

## å…³é”®ç†è®ºä¿®æ­£ä¸è°ƒè¯•è®°å½•

åœ¨å¤ç°è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å‘ç°ç›´æ¥ç…§æ¬è®ºæ–‡å…¬å¼æ— æ³•å¾—åˆ°æ­£ç¡®ç»“æœã€‚ç»è¿‡æ·±å…¥çš„ç†è®ºæ¨å¯¼å’Œç»´åº¦åˆ†æï¼Œæˆ‘ä»¬å®šä½å¹¶ä¿®æ­£äº†ä»¥ä¸‹å…³é”®é—®é¢˜ï¼š

### **æ ¸å¿ƒé€’æ¨å…³ç³»çš„ç»´åº¦å†²çªä¸ä¿®æ­£**

- **é—®é¢˜å®šä½**: è®ºæ–‡ `Eq. (25)` ä¸­çš„æ ¸å¿ƒé€’æ¨å…³ç³»æ±‚å’Œé¡¹ä¸º `Î£_k B_{mk}^{(p)} M^{kn}`ã€‚ç»è¿‡ä¸¥æ ¼çš„ç»´åº¦åˆ†æï¼Œæˆ‘ä»¬å‘ç°æ­¤é¡¹å­˜åœ¨ç»´åº¦å†²çª (`d_m x d_n`)ï¼Œæ— æ³•ä¸ `B_{mn}^{(p)}` çš„å¯¼æ•°ï¼ˆç»´åº¦ `d_n x d_m`ï¼‰ç›¸åŠ ã€‚åœ¨æˆ‘ä»¬çš„ç‰¹å®šæ¨¡å‹ä¸­ï¼Œç”±äºæ‰€æœ‰ç®€å¹¶åº¦ `d_n=d_m=2`ï¼Œè¯¥ç»´åº¦é”™è¯¯è¢«æ©ç›–ï¼Œå¯¼è‡´äº†éš¾ä»¥è¿½è¸ªçš„ç‰©ç†é”™è¯¯ã€‚

- **ç†è®ºä¿®æ­£**: æˆ‘ä»¬æ¨æ–­è®ºæ–‡åŸæ–‡å­˜åœ¨å°åˆ·ç¬”è¯¯ã€‚æ­£ç¡®çš„ã€ç»´åº¦è‡ªæ´½çš„æ±‚å’Œé¡¹åº”ä¸º `Î£_k B_{nk}^{(p)} M^{km}`ã€‚æ­¤å½¢å¼çš„ç»´åº¦ä¸º `(d_n x d_k) @ (d_k x d_m) -> d_n x d_m`ï¼Œä¸ `B_{mn}^{(p)}` çš„å¯¼æ•°ç»´åº¦ä¸€è‡´ã€‚

- **ä»£ç å®ç°**: åœ¨ `dapt_core.py` çš„ `dapt_recursive_step` å’Œ `_solve_diagonal_ode` å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†ä¿®æ­£åçš„ `Î£ B @ M` é€’æ¨é€»è¾‘ã€‚è¿™æ˜¯æœ¬é¡¹ç›®åœ¨ç†è®ºå±‚é¢æœ€é‡å¤§çš„ä¿®æ­£ã€‚

### **å½“å‰é˜¶æ®µé‡åˆ°çš„æ–°æŒ‘æˆ˜**

- **ç°è±¡**: åœ¨åº”ç”¨ä¸Šè¿°æ ¸å¿ƒç†è®ºä¿®æ­£åï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°é«˜é˜¶ä¿®æ­£çš„éå¿ è¯šåº¦æ˜æ˜¾ä¸‹é™ï¼Œå›åˆ°æ­£å¸¸åŒºé—´ï¼›ä½†å¹¶æœªå¦‚é¢„æœŸèˆ¬ç³»ç»Ÿæ€§åœ°æé«˜ç²¾åº¦ã€‚å…·ä½“è¡¨ç°ä¸ºï¼Œåœ¨å¤§éƒ¨åˆ†å‚æ•°åŒºé—´ï¼ŒäºŒé˜¶è¿‘ä¼¼çš„ä¸å¿ è¯šåº¦åè€Œé«˜äºä¸€é˜¶è¿‘ä¼¼ï¼Œä¸”äºŒè€…å¸¸é«˜äºé›¶é˜¶è¿‘ä¼¼ã€‚

## å¤ç°ç»“æœå¯¹æ¯”

æœ¬é¡¹ç›®å¯¹è®ºæ–‡ç¬¬å…«èŠ‚çš„å››ä¸ªæ•°å€¼ç¤ºä¾‹ï¼ˆå›¾2-5ï¼‰è¿›è¡Œäº†å®Œæ•´å¤ç°ã€‚ä»¥ä¸‹å±•ç¤ºäº†ç†è®ºä¿®æ­£å‰åçš„å¤ç°æ•ˆæœå¯¹æ¯”ï¼š

### å›¾2å¤ç°ç»“æœå¯¹æ¯” (Eâ‚€=1.5, Î»=0.0, Î¸â‚€=0.1)

**è®ºæ–‡åŸå›¾**:
![è®ºæ–‡å›¾2](figures/paper_originals/2.png)

**ç†è®ºä¿®æ­£å‰çš„å¤ç°å°è¯•**:
![ä¿®æ­£å‰å›¾2](figures/attempt_before_fix/2.png)

**ç†è®ºä¿®æ­£åçš„å¤ç°ç»“æœ**:
![ä¿®æ­£åå›¾2](figures/attempt_after_fix/2.png)

### å›¾3å¤ç°ç»“æœå¯¹æ¯” (Eâ‚€=1.5, Î»=0.5, Î¸â‚€=0.1)

**è®ºæ–‡åŸå›¾**:
![è®ºæ–‡å›¾3](figures/paper_originals/3.png)

**ç†è®ºä¿®æ­£å‰çš„å¤ç°å°è¯•**:
![ä¿®æ­£å‰å›¾3](figures/attempt_before_fix/3.png)

**ç†è®ºä¿®æ­£åçš„å¤ç°ç»“æœ**:
![ä¿®æ­£åå›¾3](figures/attempt_after_fix/3.png)

### å›¾4å¤ç°ç»“æœå¯¹æ¯” (Eâ‚€=1.5, Î»=1.0, Î¸â‚€=0.1)

**è®ºæ–‡åŸå›¾**:
![è®ºæ–‡å›¾4](figures/paper_originals/4.png)

**ç†è®ºä¿®æ­£å‰çš„å¤ç°å°è¯•**:
![ä¿®æ­£å‰å›¾4](figures/attempt_before_fix/4.png)

**ç†è®ºä¿®æ­£åçš„å¤ç°ç»“æœ**:
![ä¿®æ­£åå›¾4](figures/attempt_after_fix/4.png)

### å›¾5å¤ç°ç»“æœå¯¹æ¯” (Eâ‚€=1.5, Î»=0.0, Î¸â‚€=1.0)

**è®ºæ–‡åŸå›¾**:
![è®ºæ–‡å›¾5](figures/paper_originals/5.png)

**ç†è®ºä¿®æ­£å‰çš„å¤ç°å°è¯•**:
![ä¿®æ­£å‰å›¾5](figures/attempt_before_fix/5.png)

**ç†è®ºä¿®æ­£åçš„å¤ç°ç»“æœ**:
![ä¿®æ­£åå›¾5](figures/attempt_after_fix/5.png)

### å¤ç°ç»“æœåˆ†æ

ä»ä¸Šè¿°å¯¹æ¯”å¯ä»¥çœ‹å‡ºï¼š

1. **ç†è®ºä¿®æ­£çš„å¿…è¦æ€§**: ä¿®æ­£å‰çš„ç»“æœä¸è®ºæ–‡åŸå›¾å­˜åœ¨æ˜¾è‘—å·®å¼‚ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¸å¿ è¯šåº¦çš„æ•°é‡çº§å’Œå˜åŒ–è¶‹åŠ¿ä¸Šã€‚

2. **ä¿®æ­£åçš„æ”¹è¿›**: ä¿®æ­£åçš„ç»“æœåœ¨æ•´ä½“è¶‹åŠ¿ä¸Šä¸è®ºæ–‡åŸå›¾æ›´åŠ æ¥è¿‘ï¼Œä¸å¿ è¯šåº¦å›åˆ°äº†åˆç†çš„æ•°é‡çº§èŒƒå›´ã€‚

3. **ä»å­˜åœ¨çš„æŒ‘æˆ˜**: å°½ç®¡ç†è®ºä¿®æ­£è§£å†³äº†ç»´åº¦å†²çªé—®é¢˜ï¼Œä½†é«˜é˜¶ä¿®æ­£çš„è¡¨ç°ä»æœªè¾¾åˆ°é¢„æœŸçš„ç³»ç»Ÿæ€§ç²¾åº¦æå‡ï¼Œè¿™æç¤ºå¯èƒ½è¿˜å­˜åœ¨å…¶ä»–éœ€è¦æ·±å…¥ç ”ç©¶çš„ç†è®ºæˆ–æ•°å€¼é—®é¢˜ã€‚

## å®‰è£…ä¸ä½¿ç”¨

### ç¯å¢ƒè¦æ±‚
- Python â‰¥ 3.8
- NumPy â‰¥ 1.20.0
- SciPy â‰¥ 1.7.0
- Matplotlib â‰¥ 3.5.0

### å®‰è£…ä¾èµ–

```bash
# å®‰è£…æ ¸å¿ƒä¾èµ–
pip install numpy scipy matplotlib tqdm

# å®‰è£…å¼€å‘ä¾èµ–ï¼ˆå¯é€‰ï¼‰
pip install pytest pytest-cov black flake8 ipykernel
```

### åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹

```python
import numpy as np
from dapt_tools.hamiltonian import get_initial_state_in_standard_basis
from dapt_tools.exact_solver import solve_schrodinger_exact
from dapt_tools.dapt_core import run_dapt_calculation
from dapt_tools.utils import calculate_infidelity_series, plot_infidelity_comparison

# è®¾ç½®ç‰©ç†å‚æ•°ï¼ˆå¯¹åº”è®ºæ–‡Fig.2ï¼‰
params = {
    'E0': 1.5, 'lambda': 0.0, 'theta0': 0.1,
    'w': 0.5, 'hbar': 1.0, 'v': 0.5
}
s_span = np.linspace(0, 1, 101)
initial_state = get_initial_state_in_standard_basis(params)

# 1. æ±‚è§£ç²¾ç¡®è§£
exact_solution = solve_schrodinger_exact(s_span, params, initial_state)

# 2. è¿è¡ŒDAPTè®¡ç®— (åˆ°2é˜¶)
dapt_results = run_dapt_calculation(s_span, order=2, params=params)

# 3. è®¡ç®—å¹¶å¯¹æ¯”ä¸å¿ è¯šåº¦
infidelity_data = {}
for order, approx_sol in dapt_results['solutions'].items():
    infidelity_data[f'{order}-th order DAPT'] = calculate_infidelity_series(
        exact_solution, approx_sol
    )

plot_infidelity_comparison(s_span, infidelity_data, title="DAPT Infidelity vs Exact Solution (Fig. 2 params)")
plt.show()
```

## æµ‹è¯•å¥—ä»¶

é¡¹ç›®åŒ…å«å…¨é¢çš„å•å…ƒæµ‹è¯•å¥—ä»¶ï¼Œè¦†ç›–æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ã€‚

### è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
pytest tests/ -v
```

### è¿è¡Œç‰¹å®šæ¨¡å—æµ‹è¯•
```bash
# æµ‹è¯•å“ˆå¯†é¡¿é‡æ¨¡å—
pytest tests/test_hamiltonian.py -v

# æµ‹è¯•æ ¸å¿ƒç®—æ³•æ¨¡å—
pytest tests/test_core.py -v

# æµ‹è¯•å·¥å…·å‡½æ•°æ¨¡å—
pytest tests/test_utils.py -v
```

### ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
```bash
pytest tests/ --cov=dapt_tools --cov-report=html
```

## æµ‹è¯•ç»Ÿè®¡

### ğŸ“Š æœ€æ–°æµ‹è¯•æŠ¥å‘Š

- **æ€»è®¡æµ‹è¯•**: 125ä¸ª
- **æµ‹è¯•é€šè¿‡ç‡**: 100%
- **ä»£ç è¦†ç›–ç‡**: 89%
- **æµ‹è¯•æ–‡ä»¶**: 6ä¸ª

### åˆ†ç±»æµ‹è¯•ç»“æœ

| æµ‹è¯•ç±»åˆ« | æµ‹è¯•æ•°é‡ | é€šè¿‡ç‡ | è¦†ç›–ç‡ |
|---------|---------|--------|--------|
| æ ¸å¿ƒåŠŸèƒ½æµ‹è¯• | 36 | 100% | 84% |
| é›†æˆæµ‹è¯• | 10 | 100% | 89% |
| ç²¾ç¡®æ±‚è§£å™¨æµ‹è¯• | 14 | 100% | 97% |
| å“ˆå¯†é¡¿é‡æµ‹è¯• | 27 | 100% | 100% |
| å·¥å…·å‡½æ•°æµ‹è¯• | 26 | 100% | 95% |
| ä¼˜åŒ–æ€§èƒ½æµ‹è¯• | 12 | 100% | 89% |

### ä¼˜åŒ–éªŒè¯ç»“æœ

- âœ… **å‘é‡åŒ–è®¡ç®—**: einsumæ¨¡å¼ `tik,tkj->tij` å·²å®ç°å¹¶æµ‹è¯•
- âœ… **ä¸‰æ¬¡æ ·æ¡æ’å€¼**: CubicSplineç²¾åº¦æå‡425å€
- âœ… **æ³¢å‡½æ•°ç»„è£…**: çŸ©é˜µ-å‘é‡ä¹˜æ³• `B_{m0}^{(p)} @ c_init` æ­£ç¡®å®ç°
- âœ… **ç†è®ºä¿®æ­£**: DAPTé€’æ¨å…³ç³»ä¿®æ­£å¹¶éªŒè¯

è¯¦ç»†æµ‹è¯•æŠ¥å‘Šè¯·æŸ¥çœ‹ [`tests/TESTING_REPORT.md`](tests/TESTING_REPORT.md)

### è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
python -m pytest tests/ -v --cov=dapt_tools --cov-report=html

# è¿è¡Œç‰¹å®šæ ‡è®°çš„æµ‹è¯•
python -m pytest -m "optimization" -v  # ä¼˜åŒ–ç›¸å…³æµ‹è¯•
python -m pytest -m "performance" -v   # æ€§èƒ½æµ‹è¯•
python -m pytest -m "integration" -v   # é›†æˆæµ‹è¯•
```

## å‚è€ƒæ–‡çŒ®

G. Rigolin and G. Ortiz, "Degenerate adiabatic perturbation theory," *Physical Review A* **90**, 022104 (2014).

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»ï¼šGilbert Young