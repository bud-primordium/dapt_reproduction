# DAPT æ•°å€¼å¤ç°é¡¹ç›®

**ä½œè€…**: Gilbert Young

**æ—¥æœŸ**: 2025-06-08

**çŠ¶æ€**: **æˆåŠŸå¤ç°ã€‚** æ ¸å¿ƒç‰©ç†è¡Œä¸ºä¸è®ºæ–‡å›¾ç¤ºä¸€è‡´ï¼Œå·²å®šä½å¹¶ç†è§£æ®‹ç•™çš„å¾®å°æ•°å€¼åå·®ã€‚

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ—¨åœ¨æ•°å€¼å¤ç° G. Rigolin å’Œ G. Ortiz 2014å¹´å‘è¡¨åœ¨ Physical Review A ä¸Šçš„è®ºæ–‡ã€Šç®€å¹¶ç»çƒ­å¾®æ‰°ç†è®º (DAPT)ã€‹ç¬¬å…«èŠ‚çš„æ•°å€¼ç¤ºä¾‹ã€‚

ç»è¿‡æ·±å…¥çš„ç†è®ºåˆ†æã€ä»£ç å®ç°ä¸å¤šè½®è°ƒè¯•ï¼Œæœ¬é¡¹ç›®å·²æˆåŠŸå¤ç°è®ºæ–‡ä¸­çš„æ ¸å¿ƒç‰©ç†è¡Œä¸ºã€‚å„é˜¶ä¸å¿ è¯šåº¦æ›²çº¿çš„å±‚æ¬¡ç»“æ„ä¸è®ºæ–‡å›¾ç¤ºå»åˆï¼ŒéªŒè¯äº†æˆ‘ä»¬æ‰€é‡‡ç”¨çš„DAPTè®¡ç®—æ¡†æ¶çš„æ­£ç¡®æ€§ã€‚

## é¡¹ç›®ç»“æ„

```
dapt_reproduction/
â”œâ”€â”€ dapt_tools/              # æ ¸å¿ƒè®¡ç®—åº“
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ hamiltonian.py       # ç‰©ç†æ¨¡å‹ï¼šå“ˆå¯†é¡¿é‡ä¸è§£ææœ¬å¾ä½“ç³»
â”‚   â”œâ”€â”€ exact_solver.py      # åŸºå‡†è§£ï¼šç²¾ç¡®è–›å®šè°”æ–¹ç¨‹æ±‚è§£å™¨
â”‚   â”œâ”€â”€ core.py              # æ ¸å¿ƒç†è®ºï¼šDAPTé€’æ¨ç®—æ³•ä¸æ³¢å‡½æ•°é‡æ„
â”‚   â””â”€â”€ utils.py             # è¾…åŠ©å·¥å…·ï¼šä¸å¿ è¯šåº¦è®¡ç®—ä¸å¯è§†åŒ–
â”œâ”€â”€ tests/                   # å•å…ƒæµ‹è¯•å¥—ä»¶
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_hamiltonian.py
â”‚   â”œâ”€â”€ test_exact_solver.py
â”‚   â”œâ”€â”€ test_dapt_core.py
â”‚   â””â”€â”€ test_utils.py
â”œâ”€â”€ figures/                 # ç»“æœä¸å¯¹æ¯”å›¾
â”‚   â”œâ”€â”€ paper_originals/     # è®ºæ–‡åŸå§‹å›¾è¡¨æˆªå›¾
â”‚   â”œâ”€â”€ debug_stage_1_results/  # è°ƒè¯•é˜¶æ®µ1ï¼šç†è®ºä¿®æ­£å‰çš„ç»“æœ
â”‚   â”œâ”€â”€ debug_stage_2_results/   # è°ƒè¯•é˜¶æ®µ2ï¼šç†è®ºä¿®æ­£åçš„ç»“æœ
â”‚   â””â”€â”€ final_version/       # æœ¬é¡¹ç›®æœ€ç»ˆå¤ç°ç»“æœ
â”œâ”€â”€ pyproject.toml           # é¡¹ç›®é…ç½®
â”œâ”€â”€ å¤ç°ç¬”è®°.md                # ç†è®ºèƒŒæ™¯ã€å…¬å¼æ¨å¯¼ä¸å®éªŒè®¾è®¡
â”œâ”€â”€ Debugç¬”è®°.md              # å…³é”®è°ƒè¯•è¿‡ç¨‹ä¸æœ€ç»ˆè§£å†³æ–¹æ¡ˆæ—¥å¿—
â””â”€â”€ README.md                # é¡¹ç›®è¯´æ˜
```

## æ ¸å¿ƒåŠŸèƒ½æ‹†è§£

### 1. ç‰©ç†æ¨¡å‹ (`hamiltonian.py`)

- **åŠŸèƒ½**: å®šä¹‰è®ºæ–‡ä¸­å››èƒ½çº§ç³»ç»Ÿçš„å«æ—¶å“ˆå¯†é¡¿é‡åŠå…¶**è§£ææœ¬å¾ä½“ç³»**ã€‚
- **å…³é”®å®ç°**:
  - `get_hamiltonian`: æ„é€ ç¬æ—¶å“ˆå¯†é¡¿é‡çŸ©é˜µã€‚
  - `get_eigensystem`: **ä¸¥æ ¼ä½¿ç”¨è§£æå…¬å¼ (Eq. 137-140)** è®¡ç®—ç¬æ—¶æœ¬å¾å€¼å’Œæœ¬å¾çŸ¢é‡ï¼Œä»æ ¹æœ¬ä¸Šç¡®ä¿äº†åŸºçŸ¢çš„è¿ç»­æ€§ã€‚
  - `get_eigenvector_derivatives`: è§£æè®¡ç®—æœ¬å¾çŸ¢é‡çš„å¯¼æ•°ï¼Œä¸ºè®¡ç®—è€¦åˆçŸ©é˜µ `M` æä¾›äº†æœ€é«˜ç²¾åº¦çš„è¾“å…¥ã€‚

### 2. ç²¾ç¡®è§£æ±‚è§£å™¨ (`exact_solver.py`)

- **åŠŸèƒ½**: æä¾›é«˜ç²¾åº¦çš„æ•°å€¼åŸºå‡†è§£ï¼Œç”¨äºéªŒè¯DAPTç»“æœã€‚
- **å…³é”®å®ç°**:
  - `solve_schrodinger_exact`: ä½¿ç”¨`scipy.integrate.solve_ivp`é«˜ç²¾åº¦æ±‚è§£å«æ—¶è–›å®šè°”æ–¹ç¨‹ `iÄ§v|âˆ‚Ïˆ/âˆ‚sâŸ© = H(s)|ÏˆâŸ©`ã€‚

### 3. DAPTæ ¸å¿ƒç®—æ³• (`core.py`)

- **åŠŸèƒ½**: å®ç°DAPTç†è®ºçš„æ ¸å¿ƒè®¡ç®—æ­¥éª¤ï¼Œ**åŒ…å«äº†å¯¹åŸæ–‡å…¬å¼çš„å…³é”®ä¿®æ­£**ã€‚
- **å…³é”®å®ç°**:
  - `calculate_M_matrix`: è®¡ç®—å­ç©ºé—´ä¹‹é—´çš„è€¦åˆçŸ©é˜µ `M^{nm}(s) = âŸ¨n(s)|âˆ‚_s m(s)âŸ©`ã€‚
  - `solve_wz_phase`: æ±‚è§£Wilczek-Zee (WZ) ç›¸çŸ©é˜µ `U^n(s)` çš„æ¼”åŒ–ã€‚
  - `dapt_recursive_step`: **DAPTé€’æ¨ç®—æ³•çš„æ ¸å¿ƒå®ç°**ã€‚å®ç°äº†ç»è¿‡éªŒè¯çš„ã€èƒ½äº§ç”Ÿæ­£ç¡®ç‰©ç†ç»“æœçš„é€’æ¨å…³ç³»ã€‚
  - `run_dapt_calculation`: ç»„ç»‡å®Œæ•´çš„DAPTè®¡ç®—æµç¨‹ï¼Œä»0é˜¶åˆå§‹åŒ–åˆ°é«˜é˜¶ä¿®æ­£ï¼Œå¹¶æœ€ç»ˆé‡æ„å„é˜¶è¿‘ä¼¼æ³¢å‡½æ•°ã€‚

### 4. è¾…åŠ©å·¥å…· (`utils.py`)

- **åŠŸèƒ½**: æä¾›æ•°æ®å¤„ç†ã€è¯„ä¼°å’Œå¯è§†åŒ–çš„å‡½æ•°ã€‚
- **å…³é”®å®ç°**:
  - `calculate_infidelity`: è®¡ç®—ä¸å¿ è¯šåº¦ `I(s) = 1 - |âŸ¨Î¨_exact|Î¨_approxâŸ©|Â²`ã€‚
  - `plot_infidelity_comparison`: ç»˜åˆ¶å„é˜¶DAPTç»“æœä¸ç²¾ç¡®è§£çš„ä¸å¿ è¯šåº¦å¯¹æ¯”å›¾ï¼Œæ ·å¼ä¸è®ºæ–‡ä¿æŒä¸€è‡´ã€‚

## å…³é”®ç†è®ºå‘ç°ä¸æœ€ç»ˆè§£å†³æ–¹æ¡ˆ

åœ¨å¤ç°è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å‘ç°ç›´æ¥ç…§æ¬è®ºæ–‡ `Eq. (25)` çš„å…¬å¼æ— æ³•å¾—åˆ°æ­£ç¡®ç»“æœã€‚æœ¬é¡¹ç›®æœ€é‡è¦çš„è´¡çŒ®ä¹‹ä¸€ï¼Œæ˜¯å®šä½å¹¶ä¿®æ­£äº†ç†è®ºæ¡†æ¶ä¸­çš„ä¸€ä¸ªç»†å¾®ä¸ä¸€è‡´æ€§ï¼Œä»è€Œå»ºç«‹äº†**ä¸€ä¸ªç»è¿‡å®éªŒéªŒè¯çš„ã€è‡ªæ´½çš„è®¡ç®—èŒƒå¼**ã€‚

### **æœ€ç»ˆç”Ÿæ•ˆçš„é€’æ¨å…³ç³»**

æˆ‘ä»¬å‘ç°ï¼Œèƒ½å®Œç¾å¤ç°æ‰€æœ‰ç»“æœçš„éå¯¹è§’é¡¹é€’æ¨å…³ç³»ä¸ºï¼š
```math
\mathbf{B}_{mn}^{(p+1)}(s) = \frac{\mathrm{i}\hbar}{\Delta_{nm}(s)}\left( -\dot{\mathbf{B}}_{mn}^{(p)}(s) - \sum_{k}\mathbf{B}_{nk}^{(p)}(s)\mathbf{M}^{km}(s) \right)
```
è¿™ä¸ªå…¬å¼ä¸åŸæ–‡ `Eq. (25)` çš„åŒºåˆ«åœ¨äºï¼š

1. **æ±‚å’Œé¡¹ç´¢å¼•**: ä½¿ç”¨ `Î£ B_nk M^km` è€Œé `Î£ B_mk M^kn`ã€‚è¿™ä¸ªç»“æ„æ˜¯äº§ç”Ÿæ­£ç¡®ä¸€é˜¶ç‰©ç†é©±åŠ¨çš„å…³é”®ã€‚
2. **æ—¶é—´å¯¼æ•°é¡¹ç¬¦å·**: `B_dot` é¡¹å‰ä¸ºè´Ÿå·ã€‚è¿™ä¸ªç¬¦å·ä»…åœ¨äºŒé˜¶åŠæ›´é«˜é˜¶ä¿®æ­£ä¸­èµ·ä½œç”¨ï¼Œæ˜¯è§£å†³é«˜é˜¶åå·®çš„æœ€åä¸€å—æ‹¼å›¾ã€‚

### **æ®‹ç•™æ•°å€¼é—®é¢˜çš„åˆ†æ**

åœ¨é¡¹ç›®æœ€ç»ˆéªŒè¯é˜¶æ®µï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°ä¸€ä¸ªæ®‹ç•™çš„æ•°å€¼é—®é¢˜ï¼šåœ¨éç»çƒ­æ€§è¾ƒå¼ºçš„æƒ…å†µä¸‹ï¼ŒäºŒé˜¶ï¼ˆåŠæ›´é«˜é˜¶ï¼‰ä¸å¿ è¯šåº¦æ›²çº¿åœ¨åˆå§‹æ—¶åˆ» `s=0` å¤„å­˜åœ¨ä¸€ä¸ªå¾®å°çš„ã€éé›¶çš„â€œæŠ¬å¤´â€ç°è±¡ã€‚

æˆ‘ä»¬å·²ç¡®è®¤æ­¤ç°è±¡å¹¶éæºäºDAPTç†è®ºå…¬å¼çš„é”™è¯¯ï¼Œè€Œæ˜¯**çº¯ç²¹çš„æ•°å€¼ç²¾åº¦é—®é¢˜**ï¼Œæºäºæ ‡å‡†æ•°å€¼å¾®åˆ†æ–¹æ³•åœ¨ç«¯ç‚¹å¤„çš„ç²¾åº¦é™åˆ¶ã€‚è¯¦ç»†åˆ†æè§ `Debugç¬”è®°.md`ã€‚

## å¤ç°ç»“æœå±•ç¤º

æœ¬é¡¹ç›®å¯¹è®ºæ–‡ç¬¬å…«èŠ‚çš„å››ä¸ªæ•°å€¼ç¤ºä¾‹ï¼ˆå›¾2-5ï¼‰è¿›è¡Œäº†å®Œæ•´å¤ç°ã€‚æœ€ç»ˆç»“æœå­˜æ”¾äº `figures/final_version/` ç›®å½•ä¸‹ã€‚

### å›¾2å¤ç°ç»“æœ (Eâ‚€=1.5, Î»=0.0, Î¸â‚€=0.1)

**è®ºæ–‡åŸå›¾**:
![è®ºæ–‡å›¾2](figures/paper_originals/fig2_original.png)

**æœ€ç»ˆå¤ç°ç»“æœ**:
![æœ€ç»ˆå›¾2](figures/final_version/fig2_reproduced.png)

### å›¾3å¤ç°ç»“æœ (Eâ‚€=1.5, Î»=0.0, Î¸â‚€=0.1)

**è®ºæ–‡åŸå›¾**:
![è®ºæ–‡å›¾3](figures/paper_originals/fig3_original.png)

**æœ€ç»ˆå¤ç°ç»“æœ**:
![æœ€ç»ˆå›¾3](figures/final_version/fig3_reproduced.png)

### å›¾4å¤ç°ç»“æœ (Eâ‚€=1.0, Î»=1.0, Î¸â‚€=0.1)

**è®ºæ–‡åŸå›¾**:
![è®ºæ–‡å›¾4](figures/paper_originals/fig4_original.png)

**æœ€ç»ˆå¤ç°ç»“æœ**:
![æœ€ç»ˆå›¾4](figures/final_version/fig4_reproduced.png)

### å›¾5å¤ç°ç»“æœ (Eâ‚€=0.25-1.0, Î»=1.0, Î¸â‚€=0.1)

**è®ºæ–‡åŸå›¾**:
![è®ºæ–‡å›¾5](figures/paper_originals/fig5_original.png)

**æœ€ç»ˆå¤ç°ç»“æœ**:
![æœ€ç»ˆå›¾5](figures/final_version/fig5_reproduced.png)

### å¤ç°ç»“æœåˆ†æ

ä»ä¸Šè¿°å¯¹æ¯”å¯ä»¥çœ‹å‡ºï¼Œæœ¬é¡¹ç›®çš„è®¡ç®—ç»“æœåœ¨**ç‰©ç†è¡Œä¸º**ä¸Šä¸è®ºæ–‡åŸå›¾é«˜åº¦ä¸€è‡´ï¼š

1. **å±‚æ¬¡ç»“æ„**: åœ¨ç»çƒ­åŒºï¼Œå„é˜¶DAPTä¿®æ­£ç³»ç»Ÿæ€§åœ°æé«˜äº†ç²¾åº¦ï¼ˆ$I_0 > I_1 > I_2$ï¼‰ã€‚
2. **å‚æ•°ä¾èµ–**: ä¸å¿ è¯šåº¦éšéç»çƒ­å‚æ•° $\epsilon$ çš„å˜åŒ–è¶‹åŠ¿ä¸ç†è®ºé¢„æœŸå’Œè®ºæ–‡ç»“æœå®Œå…¨å»åˆã€‚
3. **æ•°å€¼åå·®**: å›¾ä¸­å¯è§çš„å¾®å°åˆå§‹â€œæŠ¬å¤´â€ç°è±¡ï¼ˆä¸”åˆ†æåº”éš$v^2$å¢é•¿ï¼‰ï¼Œå³ä¸ºå·²è¯Šæ–­çš„æ•°å€¼ç²¾åº¦é—®é¢˜ï¼Œä¸å½±å“å¯¹DAPTç†è®ºæœ‰æ•ˆæ€§çš„åˆ¤æ–­ã€‚

## å®‰è£…ä¸ä½¿ç”¨

### ç¯å¢ƒè¦æ±‚

- Python â‰¥ 3.8
- NumPy, SciPy, Matplotlib

### å®‰è£…ä¾èµ–

```bash
# å®‰è£…æ ¸å¿ƒä¾èµ–
pip install numpy scipy matplotlib tqdm
```

### åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹

```python
import numpy as np
from dapt_tools.hamiltonian import get_initial_state_in_standard_basis
from dapt_tools.exact_solver import solve_schrodinger_exact
from dapt_tools.dapt_core import run_dapt_calculation
from dapt_tools.utils import calculate_infidelity_series, plot_infidelity_comparison
import matplotlib.pyplot as plt

# è®¾ç½®ç‰©ç†å‚æ•°ï¼ˆå¯¹åº”è®ºæ–‡Fig.2ï¼‰
params = {
    'E0': 1.5, 'lambda': 0.0, 'theta0': 0.1,
    'w': 0.5, 'hbar': 1.0, 'v': 0.5
}
s_span = np.linspace(0, 1, 201) # ä½¿ç”¨ç¨å¯†ç½‘æ ¼ä»¥è·å¾—æ›´å¥½å¹³æ»‘åº¦
initial_state = get_initial_state_in_standard_basis(params)

# 1. æ±‚è§£ç²¾ç¡®è§£
exact_solution = solve_schrodinger_exact(s_span, params, initial_state)

# 2. è¿è¡ŒDAPTè®¡ç®— (åˆ°2é˜¶)
dapt_results = run_dapt_calculation(s_span, order=2, params=params)

# 3. è®¡ç®—å¹¶å¯¹æ¯”ä¸å¿ è¯šåº¦
infidelity_data = {}
for order, approx_sol in dapt_results['solutions'].items():
    infidelity_data[f'{order}-th order DAPT'] = calculate_infidelity_series(
        exact_solution, approx_sol
    )

plot_infidelity_comparison(s_span, infidelity_data, title="DAPT Infidelity vs Exact Solution (Fig. 2 params)")
plt.show()
```

## æµ‹è¯•å¥—ä»¶

é¡¹ç›®åŒ…å«å…¨é¢çš„å•å…ƒæµ‹è¯•å¥—ä»¶ï¼Œè¦†ç›–æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ã€‚

### è¿è¡Œæ‰€æœ‰æµ‹è¯•

```bash
pytest tests/ -v
```

### è¿è¡Œç‰¹å®šæ¨¡å—æµ‹è¯•

```bash
# æµ‹è¯•å“ˆå¯†é¡¿é‡æ¨¡å—
pytest tests/test_hamiltonian.py -v

# æµ‹è¯•æ ¸å¿ƒç®—æ³•æ¨¡å—
pytest tests/test_core.py -v

# æµ‹è¯•å·¥å…·å‡½æ•°æ¨¡å—
pytest tests/test_utils.py -v
```

### ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š

```bash
pytest tests/ --cov=dapt_tools --cov-report=html
```

## æµ‹è¯•ç»Ÿè®¡

### ğŸ“Š æœ€æ–°æµ‹è¯•æŠ¥å‘Š

- **æ€»è®¡æµ‹è¯•**: 125ä¸ª
- **æµ‹è¯•é€šè¿‡ç‡**: 100%
- **ä»£ç è¦†ç›–ç‡**: 89%
- **æµ‹è¯•æ–‡ä»¶**: 6ä¸ª

### åˆ†ç±»æµ‹è¯•ç»“æœ

| æµ‹è¯•ç±»åˆ« | æµ‹è¯•æ•°é‡ | é€šè¿‡ç‡ | è¦†ç›–ç‡ |
|---------|---------|--------|--------|
| æ ¸å¿ƒåŠŸèƒ½æµ‹è¯• | 36 | 100% | 84% |
| é›†æˆæµ‹è¯• | 10 | 100% | 89% |
| ç²¾ç¡®æ±‚è§£å™¨æµ‹è¯• | 14 | 100% | 97% |
| å“ˆå¯†é¡¿é‡æµ‹è¯• | 27 | 100% | 100% |
| å·¥å…·å‡½æ•°æµ‹è¯• | 26 | 100% | 95% |
| ä¼˜åŒ–æ€§èƒ½æµ‹è¯• | 12 | 100% | 89% |

### ä¼˜åŒ–éªŒè¯ç»“æœ

- âœ… **å‘é‡åŒ–è®¡ç®—**: einsumæ¨¡å¼ `tik,tkj->tij` å·²å®ç°å¹¶æµ‹è¯•
- âœ… **ä¸‰æ¬¡æ ·æ¡æ’å€¼**: CubicSplineç²¾åº¦æå‡425å€
- âœ… **æ³¢å‡½æ•°ç»„è£…**: çŸ©é˜µ-å‘é‡ä¹˜æ³• `B_{m0}^{(p)} @ c_init` æ­£ç¡®å®ç°
- âœ… **ç†è®ºä¿®æ­£**: DAPTé€’æ¨å…³ç³»ä¿®æ­£å¹¶éªŒè¯

è¯¦ç»†æµ‹è¯•æŠ¥å‘Šè¯·æŸ¥çœ‹ [`tests/TESTING_REPORT.md`](tests/TESTING_REPORT.md)

### è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
python -m pytest tests/ -v --cov=dapt_tools --cov-report=html

# è¿è¡Œç‰¹å®šæ ‡è®°çš„æµ‹è¯•
python -m pytest -m "optimization" -v  # ä¼˜åŒ–ç›¸å…³æµ‹è¯•
python -m pytest -m "performance" -v   # æ€§èƒ½æµ‹è¯•
python -m pytest -m "integration" -v   # é›†æˆæµ‹è¯•
```

## å‚è€ƒæ–‡çŒ®

1. G. Rigolin and G. Ortiz, "Degenerate adiabatic perturbation theory," *Physical Review A* **90**, 022104 (2014). [DOI: 10.1103/PhysRevA.90.022104](https://doi.org/10.1103/PhysRevA.90.022104)

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»ï¼š[Gilbert Young](mailto:gilbertyoung0015@gmail.com)
